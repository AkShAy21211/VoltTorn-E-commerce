<%- include('../layout/adminHeader.ejs') %>
<link rel="stylesheet" href="/css/dataTable.css">
  <title>Oders</title>
  <aside>
    <a href="/admin"
      style="color: rgb(45, 81, 172); position: absolute; left: 50px; top: 80px; font-size: 15px; font-weight: bold; "
      class="btn"> <-Back
  </aside>
  <!-- main content -->
  <main class="p-4 min-vh-100">
    <div class="container">
      <section class="row">
        <div class="col-md-6 col-lg-4">
          <!-- card -->
          <article class="p-4 rounded shadow-sm border-left
             mb-4">
            <a href="#" class="d-flex align-items-center" style="text-decoration: none; color: black;">
              <span class="bi bi-box h5"></span>
              <h5 class="ml-2">
                <%=oderCount %> Oders
              </h5>
            </a>
          </article>
        </div>
        <div class="col-md-6 col-lg-4">
          <article class="p-4 rounded shadow-sm border-left mb-4">
            <a href="#" class="d-flex align-items-center" style="text-decoration: none;color: black;">
              <span class="bi bi-person h5"></span>
              <h5 class="ml-2">
                <%=customers %> Customers
              </h5>
            </a>
          </article>
        </div>
        <!-- <div class="col-md-6 col-lg-4">
              <article class="p-4 rounded shadow-sm border-left mb-4">
                <a href="#" class="d-flex align-items-center">
                  <span class="bi bi-person-check h5"></span>
                  <h5 class="ml-2">Sellers</h5>
                </a>
              </article>
            </div> -->
      </section>
      <div class="jumbotron jumbotron-fluid rounded bg-white border-0 shadow-sm border-left px-4">
        <div class="container">
          <table class="table table-responsive-md" id="myTable">
            <thead>
              <tr>
                <th scope="col">Oder Id</th>
                <th scope="col">User Name</th>
                <th scope="col">Order Date</th>
                <th scope="col">Payment</th>
                <th scope="col">Order status</th>
                <th scope="col">Deivery Status</th>
                <!-- <th scope="col">Actions</th> -->
              </tr>
            </thead>
            <%oders.forEach(oder=> {%>

              <tbody>
                <!-- Sample data, replace with dynamic data from your backend -->
                <tr>
                  <th scope="row">#<%=oder.order_id %>
                  </th>
                  <td>
                    <%=oder.customerName%>
                  </td>
                  <td>
                    <%= new Date(oder.date).toLocaleString('en-US', { day: 'numeric' , month: 'short' , year: 'numeric'
                      , hour: 'numeric' , minute: 'numeric' , hour12: true }) %>
                  </td>

                  <td>
                    <%if(oder.payment){%>

                      <p class="badge bg-success">Paid</p>

                    <%}else{%>
                    <p class="badge bg-warning">Pending</p>

                    <%}  %>
                  </td>
                  <td  class="d-flex flex-column justify-content-between">
                    <%oder.products.forEach(product=>{%>
                      <%if(!product.cancelled)  {%>


                        <%if(oder.status === "Delivered" ){%>
                          <p class=" text-success">Completed</p>

                        <%}else{%>
                          <p class=" text-success">Active</p>

                        <%} %>

                      <%}else{%>
                        <p class=" text-danger">Cancelled</p>


                      <%}%>

                    <%})  %>
                  </td>
                  <td>
                    <!-- Replace 'statusSelect' ID with 'statusDropdown' class -->
                    <% if (!oder.is_cancelled && oder.status !== 'Delivered') { %>
                      <select class="statusDropdown form-select form-select-sm" data-order-id="<%= oder._id %>">
                        <option value="<%= oder.status %>">
                          <%= oder.status %>
                        </option>
                        <option value="Pending">Pending</option>
                        <option value="Shipped">Shipped</option>
                        <option value="Delivered">Delivered</option>
                        <!-- Add more status options as needed -->
                      </select>
                    <% } else if (oder.status === 'Delivered') { %>
                      <p class="text-success">Delivered</p>
                    <% } else { %>
                      <p class="text-danger">Cancelled</p>
                    <% } %>
                  </td>
                  

                  <!-- <td>
                    <button type="button" class="btn btn-primary btn-sm">View</button>

                  </td> -->
                </tr>
                <!-- Add more rows as needed -->
              </tbody>
              <%}); %>
          </table>
        </div>
      </div>

    </div>
  </main>




<script>
  // Use class selector to target all dropdowns
  const statusDropdowns = document.querySelectorAll('.statusDropdown');

  statusDropdowns.forEach(dropdown => {
      dropdown.addEventListener('change', async function() {
          var selectedValue = this.value;
          var orderId = this.dataset.orderId;
          console.log('Selected option:', selectedValue, orderId);

          // Add your custom logic here based on the selected option
          const response = await axios.patch(`http://localhost:3000/admin/oders/change-oder-status/${selectedValue}/${orderId}`);
      });
  });
</script>
<script src="/js/DataTable.js"></script>
  <%- include('../layout/adminFooter.ejs') %>