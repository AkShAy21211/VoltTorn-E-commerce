<%- include('../layout/header.ejs') %>
<style>
    .container{
        margin-top: 80px;
    }
.min-height-div1 {
  min-height: 200px; /* Adjust the height as needed */
}
.min-height-div2 {
  min-height: 500px; /* Adjust the height as needed */
}
body {
      font-family: Arial, sans-serif;
    }
    .list-item {
      padding: 10px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
    }
    .list-item i {
      font-size: 24px; /* Adjust the icon size */
      margin-right: 10px; /* Add space between icon and text */
    }
    .options{
      text-decoration: none;
    }
    .options:hover{
      text-decoration: none;
    }
    .active {
      background-color: #3498db;
      color: #fff;
    }
    .inactive {
      background-color: #fff;
      color: #333;
    }
    
 

</style>

<title>Settings | Oders</title>
<main>
  <div class="container">
    <div class="row d-flex justify-content-arround">
      <div class="setting-options  col-md-4 col-lg-4 col-xl-3 col-xxl-3  mb-2 min-height-div1 mb-md-4">
        <ul class="list-group " id="myList">
           <a class="options" href="/home/settings/profile"><li class="list-group-item inactive list-item">
              <i class="bi bi-person"></i> Profile
            </li></a> 
           <a  class="options" href="/home/settings/oders"><li class="list-group-item inactive list-item">
              <i class="bi bi-box"></i> Orders
            </li></a> 
           <a   class="options" href="/home/settings/wishlist"><li class="list-group-item  inactive list-item">
              <i class="bi bi-heart"></i> Wishlist
            </li></a> 
           <a  class="options" href=""><li class="list-group-item  inactive list-item">
              <i class="bi bi-geo-alt"></i> Address
            </li></a> 
          </ul>
      </div>
      <div class="view-settings col-md-8 col-lg-8 col-xl-9 col-xxl-8 min-height-div1 mb-md-4">
        <!-- Iterate through each order -->
        <% if (typeof oders !== 'undefined' && oders.length >0) { %>
            <table class="table">
                
              <tbody>
                <% oders.forEach((oder,i) => { %>
                    <!-- Iterate through each product in the order -->
                    <% oder.products.forEach((product, index) => { %>
                        <tr>
                            <td>
                                <img src="/images/productImages/<%= product.image %>" class="d-none  d-md-none d-lg-block d-xl-block" alt="Product Image" style="width: 100px; height: 100px;">
                            </td>
                            <td class="align-middle text-wrap w-25">
                                <%= product.name.substring(0, 50, product.name.length / 2) %>
                            </td>
                            <td class="align-middle text-center">
                                <b>Total</b>: <%= oder.totalAmount %>
                            </td>
            
                            <% if (!product.cancelled) { %>
                                <% if (oder.status === 'Pending') { %>
                                    <td class="align-middle text-center text-warning">
                                        <%= oder.status %>
                                    </td>
                                <% } else if (oder.status === 'Shipped' || oder.status === 'Delivered') { %>
                                    <% if (oder.status === 'Delivered') { %>
                                        <td class="align-middle text-center">
                                            <%= new Date().toLocaleString() %>
                                        </td>
                                    <% } %>
            
                                    <td class="align-middle text-center text-success">
                                        <%= oder.status %>
                                    </td>
                                <% } else { %>
                                    <!-- Handle other cases or set a default class -->
                                    <td class="align-middle text-center">
                                        <%= oder.status %>
                                    </td>
                                <% } %>
            
                                <td class="align-middle text-center">
                                    <% if (!product.cancelled && (oder.status === 'Pending' || oder.status === 'Shipped')) { %>
                        
                                        <a type="button" onclick="return showCancelOrderAlert('<%=oder.order_id %>', '<%=product.product_id%>', '<%=i %>', '<%=index %>')" class="btn btn-danger btn-sm text-white">Cancel Order</a>

                                    <% } else if (product.cancelled) { %>
                                        <span class="text-info">Cancelled</span>
                                    <% } %>
                                </td>
                            <% } else { %>
                                <!-- Add handling for cancelled orders -->
                                <td class="align-middle text-center">
                                    <span class="text-info">Cancelled</span>
                                </td>
                            <% } %>
                        </tr>
                    <% }); %>
                <% }); %>
            </tbody>
            
            </table>
            <% } else { %>
              <table class="table">
                  <tbody>
                      <tr>      
                          <h5 class="text-dark text-center">No Orders Available</h5>
                      </tr>
                  </tbody>
              </table>
          <% } %>
    </div>
    
      
          </div>
  </div>
</main>


<script>
  function showCancelOrderAlert(orderId, productId, productIndex, orderIndex) {
      $.confirm({
          title: 'Cancel Order',
          content: 'Are you sure you want to cancel this order?',
          type: 'blue',
          typeAnimated: true,
          buttons: {
              confirm: {
                  text: 'Yes',
                  btnClass: 'btn-danger',
                  action: function () {
                      // If the user confirms, navigate to the specified URL
                      window.location.href = `/home/settings/cancel-oders/${orderId}/${productId}/${productIndex}/${orderIndex}`;
                  }
              },
              cancel: {
                  text: 'No',
                  btnClass: 'btn-secondary',
                  action: function () {
                      // If the user cancels, do nothing or provide additional logic
                  }
              }
          }
      });
  
      // Prevent the default behavior of the anchor tag
      return false;
  }
  </script>
<%- include('../layout/footer.ejs') %>
